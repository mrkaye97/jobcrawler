<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Manager</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>
    <h1>My Companies</h1>
    <table id="company-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Board URL</th>
                <th>Scraping Method</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button id="add-company-btn">Add Company</button>
    <script>
        const addCompanyBtn = document.getElementById('add-company-btn');
        addCompanyBtn.addEventListener('click', function () {
            const defaultName = 'Default Company';
            const defaultBoardUrl = 'https://www.example.com';
            const defaultScrapingMethod = 'soup';

            const company = {
                name: defaultName,
                board_url: defaultBoardUrl,
                scraping_method: defaultScrapingMethod
            };

            // Create the row with default values first
            const tableBody = document.querySelector('#company-table tbody');
            const row = createCompanyRow(company);
            tableBody.appendChild(row);

            fetch('http://127.0.0.1:5000/companies', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(company)
            }).then(response => response.json())
                .then(newCompany => {
                    // Update the row's id with the id from the server response
                    row.dataset.id = newCompany.id;

                    // Update the row with the data from the server
                    row.replaceWith(createCompanyRow(newCompany));
                });
        });

        function createCompanyRow(company) {
            const row = document.createElement('tr');
            row.dataset.id = company.id;

            const nameCell = document.createElement('td');
            const boardUrlCell = document.createElement('td');
            const scrapingMethodCell = document.createElement('td');

            nameCell.contentEditable = true;
            boardUrlCell.contentEditable = true;
            scrapingMethodCell.contentEditable = true;

            nameCell.innerText = company.name;
            boardUrlCell.innerText = company.board_url;
            scrapingMethodCell.innerText = company.scraping_method;

            row.appendChild(nameCell);
            row.appendChild(boardUrlCell);
            row.appendChild(scrapingMethodCell);

            const actionsCell = document.createElement('td');
            const deleteBtn = document.createElement('button');
            const updateBtn = document.createElement('button');

            deleteBtn.innerText = 'Delete';
            // Add event listener for deleteBtn, similar to the one in createBoardRow function

            updateBtn.innerText = 'Update';
            // Add event listener for updateBtn, similar to the one in createBoardRow function

            actionsCell.appendChild(deleteBtn);
            actionsCell.appendChild(updateBtn);
            row.appendChild(actionsCell);

            return row;
        }


    </script>
</body>

<body>
    <h1>My Job Searches</h1>
    <table id="board-table">
        <thead>
            <tr>
                <th>Company ID</th>
                <th>Search Text</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button id="add-row-btn">Add Row</button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch('http://127.0.0.1:5000/searches')
                .then(response => response.json())
                .then(boards => {
                    const tableBody = document.querySelector('#board-table tbody');

                    boards.forEach(board => {
                        const row = createBoardRow(board);
                        tableBody.appendChild(row);
                    });
                });

            const addRowBtn = document.getElementById('add-row-btn');
            addRowBtn.addEventListener('click', function () {
                const defaultCompanyId = 123;
                const defaultSearchText = 'A regex';

                const board = {
                    company_id: defaultCompanyId,
                    search_text: defaultSearchText
                };

                const tableBody = document.querySelector('#board-table tbody');
                const row = createBoardRow(board);
                tableBody.appendChild(row);

                fetch('http://127.0.0.1:5000/searches', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(board)
                }).then((response) => {
                    console.log(response);
                    response.json().then(newBoard => {
                        console.log(newBoard);
                        row.dataset.id = newBoard.id;
                    });
                });
            });
        });

        function createBoardRow(board) {
            const row = document.createElement('tr');
            row.dataset.id = board.id;

            const companyIdCell = document.createElement('td');
            const searchCell = document.createElement('td');

            companyIdCell.contentEditable = true;
            searchCell.contentEditable = true;

            companyIdCell.innerText = board.companyId;
            searchCell.innerText = board.search_text;

            row.appendChild(companyIdCell);
            row.appendChild(searchCell);

            const actionsCell = document.createElement('td');
            const deleteBtn = document.createElement('button');
            const updateBtn = document.createElement('button');

            deleteBtn.innerText = 'Delete';
            deleteBtn.addEventListener('click', function () {
                fetch(`http://127.0.0.1:5000/searches/${row.dataset.id}`, {
                    method: 'DELETE'
                }).then(() => {
                    row.remove();
                });
            });

            updateBtn.innerText = 'Update';
            updateBtn.addEventListener('click', function () {
                const formData = new FormData();
                formData.append('company_id', companyIdCell.innerText);
                formData.append('search_text', searchCell.innerText);

                fetch(`http://127.0.0.1:5000/searches/${row.dataset.id}`, {
                    method: 'PUT',
                    body: formData
                });
            });

            actionsCell.appendChild(deleteBtn);
            actionsCell.appendChild(updateBtn);
            row.appendChild(actionsCell);

            return row;
        }
    </script>
</body>

</html>